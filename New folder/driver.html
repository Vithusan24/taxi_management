<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Taxi Admin Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #4fc3f7;
      --primary-dark: #0288d1;
      --secondary-color: #4caf50;
      --danger-color: #f44336;
      --warning-color: #ff9800;
      --dark-color: #1e1e2f;
      --light-color: #f4f4f4;
      --sidebar-width: 250px;
      --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      display: flex;
      min-height: 100vh;
      background: var(--light-color);
      color: #333;
    }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--dark-color);
      color: #fff;
      padding: 20px 0;
      flex-shrink: 0;
      height: 100vh;
      overflow-y: auto;
      position: fixed;
      transition: var(--transition);
      z-index: 1000;
    }

    .sidebar h2 {
      text-align: center;
      margin: 20px 0 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar ul {
      list-style: none;
      padding: 0 15px;
    }

    .sidebar li {
      margin-bottom: 5px;
      position: relative;
    }

    .sidebar a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      display: flex;
      align-items: center;
      padding: 12px 15px;
      border-radius: 5px;
      transition: var(--transition);
    }

    .sidebar a:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .sidebar .active > a {
      background: var(--primary-color);
      color: white;
    }

    .sidebar a i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }

    .submenu {
      display: none;
      margin-left: 15px;
      padding-left: 15px;
      border-left: 2px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar li.active .submenu {
      display: block;
    }

    .submenu li a {
      padding: 8px 15px;
      font-size: 0.9rem;
    }

    /* Main Content */
    .content {
      margin-left: var(--sidebar-width);
      padding: 30px;
      width: calc(100% - var(--sidebar-width));
      transition: var(--transition);
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    .dashboard-header h1 {
      font-size: 24px;
      color: var(--dark-color);
    }

    .user-actions {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .notification-bell {
      position: relative;
      cursor: pointer;
      font-size: 1.2rem;
      color: var(--dark-color);
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger-color);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary-color);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 10px;
    }

    .tabs button {
      padding: 10px 20px;
      background: #e0e0e0;
      color: #555;
      border: none;
      cursor: pointer;
      border-radius: 5px 5px 0 0;
      transition: var(--transition);
      font-weight: 500;
    }

    .tabs button:hover {
      background: #d0d0d0;
    }

    .tabs button.active {
      background: var(--primary-color);
      color: white;
    }

    /* Tab Content */
    .tab-content {
      display: none;
      background: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: var(--card-shadow);
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .tab-content.active {
      display: block;
    }

    .tab-content h3 {
      margin-bottom: 20px;
      color: var(--dark-color);
    }

    /* Forms */
    form {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #555;
    }

    input, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 0.9rem;
      transition: var(--transition);
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(79, 195, 247, 0.2);
    }

    button[type="submit"] {
      grid-column: 1 / -1;
      padding: 12px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: var(--transition);
      margin-top: 10px;
    }

    button[type="submit"]:hover {
      background: var(--primary-dark);
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      box-shadow: var(--card-shadow);
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    th {
      background: var(--dark-color);
      color: white;
      font-weight: 500;
    }

    tr:nth-child(even) {
      background: #f9f9f9;
    }

    tr:hover {
      background: #f0f0f0;
    }

    .status {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      display: inline-block;
    }

    .status.active {
      background: #e8f5e9;
      color: var(--secondary-color);
    }

    .status.inactive {
      background: #ffebee;
      color: var(--danger-color);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .edit-form-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .edit-form {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 600px;
      max-width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }

    .form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .close-btn {
      cursor: pointer;
      font-size: 24px;
      color: #666;
    }

    .form-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      grid-column: 1 / -1;
    }

    .cancel-btn {
      padding: 8px 15px;
      background: #e0e0e0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .save-btn {
      padding: 8px 15px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Mobile Menu Toggle */
    .menu-toggle {
      display: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--dark-color);
    }

    /* Responsive */
    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .content {
        margin-left: 0;
        width: 100%;
      }

      .menu-toggle {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .tabs {
        flex-wrap: wrap;
      }

      .tabs button {
        flex: 1 0 auto;
      }

      form {
        grid-template-columns: 1fr;
      }

      .edit-form {
        width: 90%;
      }
    }

    @media (max-width: 576px) {
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .user-actions {
        width: 100%;
        justify-content: space-between;
      }

      table {
        display: block;
        overflow-x: auto;
      }

      .form-group {
        margin-bottom: 10px;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 5px;
        box-sizing: border-box;
      }
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
 <!-- Sidebar -->
  <nav class="sidebar" aria-label="Main navigation">
    <h2 id="sidebar-heading">Taxi Dashboard</h2>
    <ul aria-labelledby="sidebar-heading">
      <li>
        <a href="dash.html"><i class="fa fa-tachometer-alt"></i> <span>Dashboard</span></a>
      </li>
      <li>
        <a href="driver.html"><i class="fa fa-user-tie"></i> <span>Driver Management</span></a>
        <ul class="submenu">
          <li><a href="driver.html" onclick="showTab(event, 'addDriver')">Add Driver</a></li>
          <li><a href="driver.html" onclick="showTab(event, 'driverList')">Driver List</a></li>
          <li><a href="driver.html" onclick="showTab(event, 'driverHistory')">Driver History</a></li>
        </ul>
      </li>
      <li class="active">
        <a href="#" onclick="showTab(event, 'addAgency')"><i class="fa fa-building"></i> <span>Agency Management</span></a>
        <ul class="submenu">
          <li><a href="#" onclick="showTab(event, 'addAgency')">Add Agency</a></li>
          <li><a href="#" onclick="showTab(event, 'agencyList')">Agency List</a></li>
          <li><a href="#" onclick="showTab(event, 'agencyHistory')">Agency History</a></li>
        </ul>
      </li>
      <li>
        <a href="order.html"><i class="fa fa-car"></i> <span>Order Management</span></a>
        <ul class="submenu">
          <li><a href="order.html" onclick="showTab(event, 'newOrder')">New Order</a></li>
          <li><a href="order.html" onclick="showTab(event, 'activeOrders')">Active Orders</a></li>
          <li><a href="order.html" onclick="showTab(event, 'orderHistory')">Order History</a></li>
        </ul>
      </li>
      <li>
        <a href="pay.html"><i class="fa fa-credit-card"></i> <span>Payments</span></a>
        <ul class="submenu">
          <li><a href="pay.html" onclick="showTab(event, 'driverPayments')">Driver Payments</a></li>
          <li><a href="pay.html" onclick="showTab(event, 'agencyPayments')">Agency Payments</a></li>
          <li><a href="pay.html" onclick="showTab(event, 'paymentHistory')">Payment History</a></li>
        </ul>
      </li>
      <li>
        <a href="reo.html"><i class="fa fa-chart-line"></i> <span>Reports</span></a>
      </li>
      <li>
        <a href="set.html"><i class="fa fa-cog"></i> <span>Settings</span></a>
      </li>
      <li>
        <a href="login.html"><i class="fa fa-sign-out-alt"></i> <span>Logout</span></a>
      </li>
    </ul>
  </nav>


  <!-- Content -->
  <main class="content">
    <!-- Header -->
    <div class="dashboard-header">
      <div style="display: flex; align-items: center; gap: 15px;">
        <i class="fas fa-bars menu-toggle" onclick="toggleSidebar()" aria-label="Toggle sidebar"></i>
        <h1>Driver Management</h1>
      </div>
      <div class="user-actions">
        <div class="notification-bell" aria-label="Notifications">
          <i class="fa fa-bell"></i>
          <span class="notification-badge">3</span>
        </div>
        <div class="user-profile" aria-label="User profile">
          <div class="user-avatar">VS</div>
          <span>Vithu San</span>
        </div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab-button active" onclick="showTab('addDriver')" aria-selected="true">Add Driver</button>
      <button class="tab-button" onclick="showTab('driverList')" aria-selected="false">Driver List</button>
      <button class="tab-button" onclick="showTab('driverHistory')" aria-selected="false">Driver History</button>
    </div>

    <!-- Add Driver Tab -->
    <div id="addDriver" class="tab-content active">
      <h3>Add New Driver</h3>
      <form id="driverForm">
        <div class="form-group">
          <label for="driverName">Driver Name</label>
          <input type="text" id="driverName" placeholder="Enter driver name" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="driverPhoto">Driver Photo</label>
          <input type="file" id="driverPhoto" accept="image/*" required aria-required="true">
          <div id="driverPhotoPreview" style="width: 100px; height: 100px; border: 1px dashed #ddd; margin-top: 10px; display: flex; justify-content: center; align-items: center; color: #999;">Preview</div>
        </div>
        <div class="form-group">
          <label for="licenseNumber">License Number</label>
          <input type="text" id="licenseNumber" placeholder="Enter license number" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="licensePhoto">License (Both Sides)</label>
          <input type="file" id="licensePhoto" accept="image/*" multiple required aria-required="true">
          <small>Please upload both front and back sides (2 images)</small>
          <div id="licensePhotoPreview" style="display: flex; gap: 10px; margin-top: 10px;"></div>
        </div>
        <div class="form-group">
          <label for="licenseExpiry">License Expiry Date</label>
          <input type="date" id="licenseExpiry" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="phoneNumber">Phone Number</label>
          <input type="tel" id="phoneNumber" placeholder="Enter phone number" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" placeholder="Enter email address" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="vehicleType">Vehicle Type</label>
                    <input type="text" id="driverName" placeholder="Enter vehicle Type" required aria-required="true">

        </div>
        <div class="form-group">
          <label for="vehicleNumber">Vehicle Number</label>
          <input type="text" id="vehicleNumber" placeholder="Enter vehicle number" required aria-required="true">
        </div>
        <div class="form-group">
          <label for="vehiclePhoto">Vehicle Photo</label>
          <input type="file" id="vehiclePhoto" accept="image/*" required aria-required="true">
          <div id="vehiclePhotoPreview" style="width: 100px; height: 100px; border: 1px dashed #ddd; margin-top: 10px; display: flex; justify-content: center; align-items: center; color: #999;">Preview</div>
        </div>
        <div class="form-group">
          <label for="insuranceExpiry">Insurance Expiry Date</label>
          <input type="date" id="insuranceExpiry" required aria-required="true">
        </div>
        <button type="submit">Add Driver</button>
      </form>
    </div>

    <!-- Driver List Tab -->
    <div id="driverList" class="tab-content">
      <h3>Driver List</h3>
      <div class="toolbar" style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
        <div class="search-box" style="position: relative;">
          <input type="text" id="searchDriver" placeholder="Search drivers..." style="padding: 8px 15px; border: 1px solid #ddd; border-radius: 4px; width: 300px;" aria-label="Search drivers">
          <i class="search-icon" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #666;">🔍</i>
        </div>
        <div class="filters" style="display: flex; gap: 10px;">
          <select id="filterStatus" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;" aria-label="Filter by status">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
          <select id="filterVehicle" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;" aria-label="Filter by vehicle type">
            <option value="">All Vehicles</option>
            <option value="car">Car</option>
            <option value="van">Van</option>
            <option value="tuk">Tuk Tuk</option>
            <option value="suv">SUV</option>
          </select>
        </div>
      </div>
      <div style="overflow-x: auto; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-radius: 8px;">
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="background-color: #f5f5f5;">
              <th style="padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd;">Name</th>
              <th style="padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd;">License</th>
              <th style="padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd;">Phone</th>
              <th style="padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd;">Vehicle</th>
              <th style="padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd;">Status</th>
              <th style="padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd;">Expiry Alerts</th>
              <th style="padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd;">Actions</th>
            </tr>
          </thead>
          <tbody id="driverTableBody">
            <!-- Populated dynamically -->
          </tbody>
        </table>
      </div>
      <div class="pagination" style="margin-top: 20px; display: flex; justify-content: center; gap: 5px;">
        <button onclick="paginateDrivers(currentPage - 1)" style="padding: 5px 10px; border: 1px solid #ddd; background: white; cursor: pointer;">«</button>
        <span id="paginationButtons"></span>
        <button onclick="paginateDrivers(currentPage + 1)" style="padding: 5px 10px; border: 1px solid #ddd; background: white; cursor: pointer;">»</button>
      </div>
    </div>

    <!-- Edit Driver Modal -->
    <div class="edit-form-container" id="editFormContainer" role="dialog" aria-hidden="true">
      <div class="edit-form">
        <div class="form-header">
          <h3 class="form-title">Edit Driver Details</h3>
          <button class="close-btn" id="closeEditForm" aria-label="Close edit form">×</button>
        </div>
        <form id="driverEditForm">
          <input type="hidden" id="editDriverId">
          <div class="form-group">
            <label for="editDriverName">Driver Name</label>
            <input type="text" id="editDriverName" required aria-required="true">
          </div>
          <div class="form-group">
            <label for="editDriverPhoto">Driver Photo</label>
            <input type="file" id="editDriverPhoto" accept="image/*">
            <div id="editDriverPhotoPreview" style="width: 100px; height: 100px; border: 1px dashed #ddd; margin-top: 10px; display: flex; justify-content: center; align-items: center; color: #999;">Preview</div>
          </div>
          <div class="form-group">
            <label for="editDriverLicense">License Number</label>
            <input type="text" id="editDriverLicense" required aria-required="true">
          </div>
          <div class="form-group">
            <label for="editLicensePhoto">License (Both Sides)</label>
            <input type="file" id="editLicensePhoto" accept="image/*" multiple>
            <small>Upload both front and back sides (2 images)</small>
            <div id="editLicensePhotoPreview" style="display: flex; gap: 10px; margin-top: 10px;"></div>
          </div>
          <div class="form-group">
            <label for="editLicenseExpiry">License Expiry Date</label>
            <input type="date" id="editLicenseExpiry" required aria-required="true">
          </div>
          <div class="form-group">
            <label for="editPhoneNumber">Phone Number</label>
            <input type="tel" id="editPhoneNumber" required aria-required="true">
          </div>
          <div class="form-group">
            <label for="editEmail">Email Address</label>
            <input type="email" id="editEmail" required aria-required="true">
          </div>
          <div class="form-group">
            <label for="editVehicleType">Vehicle Type</label>
            <label id="editVehicleType" required aria-required="true">
              <input type="tel" id="editPhoneNumber" required aria-required="true>
              
            </label>
          </div>
          <div class="form-group">
            <label for="editVehicleNumber">Vehicle Number</label>
            <input type="text" id="editVehicleNumber" required aria-required="true">
          </div>
          <div class="form-group">
            <label for="editVehiclePhoto">Vehicle Photo</label>
            <input type="file" id="editVehiclePhoto" accept="image/*">
            <div id="editVehiclePhotoPreview" style="width: 100px; height: 100px; border: 1px dashed #ddd; margin-top: 10px; display: flex; justify-content: center; align-items: center; color: #999;">Preview</div>
          </div>
          <div class="form-group">
            <label for="editInsuranceExpiry">Insurance Expiry Date</label>
            <input type="date" id="editInsuranceExpiry" required aria-required="true">
          </div>
          <div class="form-group">
            <label for="editDriverStatus">Status</label>
            <select id="editDriverStatus" required aria-required="true">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="on_leave">On Leave</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="cancel-btn" id="cancelEdit" aria-label="Cancel edit">Cancel</button>
            <button type="submit" class="save-btn" aria-label="Save changes">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <!-- View Driver Modal -->
    <div id="viewDriverModal" class="modal" role="dialog" aria-hidden="true">
      <div style="background: #fff; padding: 20px; border-radius: 10px; width: 600px; position: relative; max-height: 90vh; overflow-y: auto;">
        <span id="closeViewModal" style="position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer;" aria-label="Close view modal">×</span>
        <h3>Driver Details</h3>
        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
          <div style="width: 120px;">
            <img id="viewDriverPhoto" src="https://via.placeholder.com/120" alt="Driver" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover;">
          </div>
          <div style="flex: 1;">
            <h2 id="viewDriverName" style="margin: 0 0 10px 0;">Kumar Perera</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <div>
                <p style="margin: 5px 0; font-size: 14px;"><strong>License:</strong> <span id="viewLicense">DL-123456</span></p>
                <p style="margin: 5px 0; font-size: 14px;"><strong>Phone:</strong> <span id="viewPhone">0771234567</span></p>
                <p style="margin: 5px 0; font-size: 14px;"><strong>Email:</strong> <span id="viewEmail">kumar@example.com</span></p>
              </div>
              <div>
                <p style="margin: 5px 0; font-size: 14px;"><strong>Vehicle:</strong> <span id="viewVehicle">Car - NP1234</span></p>
                <p style="margin: 5px 0; font-size: 14px;"><strong>Status:</strong> <span id="viewStatus" class="status active">Active</span></p>
              </div>
            </div>
          </div>
        </div>
        <div style="margin-bottom: 20px;">
          <h4 style="margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">Document Details</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div>
              <p style="margin: 5px 0; font-size: 14px;"><strong>License Expiry:</strong> <span id="viewLicenseExpiry">2023-12-31</span></p>
              <div id="viewLicensePhotos" style="display: flex; gap: 10px; margin-top: 10px;">
                <img src="https://via.placeholder.com/150x100?text=License+Front" style="width: 120px; height: 80px; object-fit: cover; border: 1px solid #ddd;">
                <img src="https://via.placeholder.com/150x100?text=License+Back" style="width: 120px; height: 80px; object-fit: cover; border: 1px solid #ddd;">
              </div>
            </div>
            <div>
              <p style="margin: 5px 0; font-size: 14px;"><strong>Insurance Expiry:</strong> <span id="viewInsuranceExpiry">2023-12-31</span></p>
              <div id="viewVehiclePhoto" style="margin-top: 10px;">
                <img src="https://via.placeholder.com/250x150?text=Vehicle+Photo" style="width: 100%; height: 80px; object-fit: cover; border: 1px solid #ddd;">
              </div>
            </div>
          </div>
        </div>
        <div>
          <h4 style="margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">Additional Notes</h4>
          <p id="viewNotes" style="font-size: 14px; color: #666; margin: 0;">No additional notes available.</p>
        </div>
      </div>
    </div>

    <!-- Driver History Tab -->
    <div id="driverHistory" class="tab-content">
      <h3>Driver History</h3>
      <div style="margin-bottom: 15px;">
        <label for="driverSelect">Select Driver:</label>
        <select id="driverSelect" style="width: 200px; margin-left: 10px;" aria-label="Select driver for history">
          <option value="">All Drivers</option>
          <option value="1">Kumar Perera</option>
          <option value="2">Sunil Fernando</option>
          <option value="3">Amal Silva</option>
        </select>
      </div>
      <div style="overflow-x: auto;">
        <table>
          <thead>
            <tr>
              <th>Driver Name</th>
              <th>Date</th>
              <th>Trip</th>
              <th>Fare (Rs.)</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="historyTableBody">
            <tr>
              <td>Kumar Perera</td>
              <td>2025-05-15</td>
              <td>Jaffna to Kilinochchi</td>
              <td>2,000</td>
              <td>Completed</td>
            </tr>
            <tr>
              <td>Kumar Perera</td>
              <td>2025-05-14</td>
              <td>Colombo to Kandy</td>
              <td>5,500</td>
              <td>Completed</td>
            </tr>
            <tr>
              <td>Sunil Fernando</td>
              <td>2025-05-15</td>
              <td>Galle to Matara</td>
              <td>1,800</td>
              <td>Completed</td>
            </tr>
            <tr>
              <td>Amal Silva</td>
              <td>2025-05-13</td>
              <td>Negombo to Colombo</td>
              <td>1,200</td>
              <td>Cancelled</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <script>
    // Sample driver data (mock API)
    let drivers = JSON.parse(localStorage.getItem('drivers')) || [
      { id: 'DL-123456', name: 'Kumar Perera', license: 'DL-123456', phone: '0771234567', vehicle: 'Car - NP1234', status: 'active', licenseExpiry: '2023-12-31', insuranceExpiry: '2024-06-30', email: 'kumar.perera@example.com', driverPhoto: 'https://via.placeholder.com/120', licensePhotos: ['https://via.placeholder.com/150x100?text=License+Front', 'https://via.placeholder.com/150x100?text=License+Back'], vehiclePhoto: 'https://via.placeholder.com/250x150?text=Vehicle+Photo' },
      { id: 'DL-789012', name: 'Sunil Fernando', license: 'DL-789012', phone: '0777654321', vehicle: 'Van - NP5678', status: 'active', licenseExpiry: '2024-12-31', insuranceExpiry: '2024-06-30', email: 'sunil.fernando@example.com', driverPhoto: 'https://via.placeholder.com/120', licensePhotos: ['https://via.placeholder.com/150x100?text=License+Front', 'https://via.placeholder.com/150x100?text=License+Back'], vehiclePhoto: 'https://via.placeholder.com/250x150?text=Vehicle+Photo' },
      { id: 'DL-345678', name: 'Amal Silva', license: 'DL-345678', phone: '0771122334', vehicle: 'Tuk Tuk - NP9012', status: 'inactive', licenseExpiry: '2023-12-31', insuranceExpiry: '2022-12-31', email: 'amal.silva@example.com', driverPhoto: 'https://via.placeholder.com/120', licensePhotos: ['https://via.placeholder.com/150x100?text=License+Front', 'https://via.placeholder.com/150x100?text=License+Back'], vehiclePhoto: 'https://via.placeholder.com/250x150?text=Vehicle+Photo' }
    ];

    let currentPage = 1;
    const perPage = 5;

    // Tab functionality
    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      document.querySelector(`.tab-button[onclick="showTab('${tabId}')"]`).classList.add('active');
      document.querySelectorAll('.tab-button').forEach(btn => btn.setAttribute('aria-selected', btn.classList.contains('active')));
    }

    // Toggle sidebar on mobile
    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      sidebar.classList.toggle('active');
      sidebar.setAttribute('aria-hidden', !sidebar.classList.contains('active'));
    }

    // Load drivers into table
    function loadDrivers(page = 1) {
      const tbody = document.getElementById('driverTableBody');
      tbody.innerHTML = '';
      const start = (page - 1) * perPage;
      const end = start + perPage;
      const paginatedDrivers = drivers.slice(start, end);

      paginatedDrivers.forEach(driver => {
        const today = new Date();
        const licenseExpiry = new Date(driver.licenseExpiry);
        const insuranceExpiry = new Date(driver.insuranceExpiry);
        let expiryAlert = 'All documents valid';
        let alertColor = '#4CAF50';
        if (licenseExpiry < today) {
          expiryAlert = '❌ License expired';
          alertColor = '#f44336';
        } else if (licenseExpiry < new Date(today.getTime() + 15 * 24 * 60 * 60 * 1000)) {
          expiryAlert = '⚠️ License expires soon';
          alertColor = '#FF9800';
        } else if (insuranceExpiry < today) {
          expiryAlert = '❌ Insurance expired';
          alertColor = '#f44336';
        } else if (insuranceExpiry < new Date(today.getTime() + 15 * 24 * 60 * 60 * 1000)) {
          expiryAlert = '⚠️ Insurance expires soon';
          alertColor = '#FF9800';
        }

        const row = document.createElement('tr');
        row.innerHTML = `
          <td style="display: flex; align-items: center;">
            <img src="${driver.driverPhoto}" alt="${driver.name}" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
            ${driver.name}
          </td>
          <td>${driver.license}</td>
          <td>${driver.phone}</td>
          <td>
            <div style="display: flex; align-items: center;">
              <span style="margin-right: 5px;">${driver.vehicle.split(' - ')[0]}</span>
              <span style="background: #f0f0f0; padding: 2px 6px; border-radius: 4px; font-size: 12px;">${driver.vehicle.split(' - ')[1]}</span>
            </div>
          </td>
          <td><span class="status ${driver.status}" style="padding: 4px 8px; border-radius: 4px; font-size: 12px;">${driver.status.charAt(0).toUpperCase() + driver.status.slice(1)}</span></td>
          <td><span class="expiry-alert" style="color: ${alertColor}; font-size: 12px;">${expiryAlert}</span></td>
          <td>
            <div style="display: flex; gap: 5px;">
              <button class="action-btn view-btn" style="background: #2196F3; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer;" aria-label="View ${driver.name}">View</button>
              <button class="action-btn edit-btn" style="background: #4CAF50; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer;" aria-label="Edit ${driver.name}">Edit</button>
              <button class="action-btn delete-btn" style="background: #f44336; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer;" aria-label="Delete ${driver.name}">Delete</button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });

      // Update pagination
      const totalPages = Math.ceil(drivers.length / perPage);
      const paginationButtons = document.getElementById('paginationButtons');
      paginationButtons.innerHTML = '';
      for (let i = 1; i <= totalPages; i++) {
        paginationButtons.innerHTML += `<button onclick="paginateDrivers(${i})" style="padding: 5px 10px; border: 1px solid #ddd; background: ${i === page ? '#4CAF50' : 'white'}; color: ${i === page ? 'white' : 'black'}; cursor: pointer;">${i}</button>`;
      }
    }

    // Paginate drivers
    function paginateDrivers(page) {
      if (page < 1 || page > Math.ceil(drivers.length / perPage)) return;
      currentPage = page;
      loadDrivers(page);
    }

    // Debounce function for search
    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      showTab('addDriver');
      loadDrivers();

      // Sidebar submenu toggle
      document.querySelectorAll('.sidebar a').forEach(link => {
        link.addEventListener('click', function(e) {
          const parentLi = this.parentElement;
          const submenu = parentLi.querySelector('.submenu');
          if (submenu) {
            e.preventDefault();
            const isExpanded = parentLi.classList.toggle('active');
            this.setAttribute('aria-expanded', isExpanded);
            submenu.setAttribute('aria-hidden', !isExpanded);
          }
        });
      });

      // Add Driver Form submission
      document.getElementById('driverForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const licensePhotos = document.getElementById('licensePhoto').files;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phoneNumber').value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const phoneRegex = /^\d{10}$/;

        if (licensePhotos.length !== 2) {
          alert('Please upload exactly 2 license photos (front and back).');
          return;
        }
        if (!emailRegex.test(email)) {
          alert('Please enter a valid email address.');
          return;
        }
        if (!phoneRegex.test(phone)) {
          alert('Please enter a valid 10-digit phone number.');
          return;
        }

        const newDriver = {
          id: document.getElementById('licenseNumber').value,
          name: document.getElementById('driverName').value,
          license: document.getElementById('licenseNumber').value,
          phone: document.getElementById('phoneNumber').value,
          vehicle: `${document.getElementById('vehicleType').value} - ${document.getElementById('vehicleNumber').value}`,
          status: 'active',
          licenseExpiry: document.getElementById('licenseExpiry').value,
          insuranceExpiry: document.getElementById('insuranceExpiry').value,
          email: document.getElementById('email').value,
          driverPhoto: document.getElementById('driverPhotoPreview').querySelector('img')?.src || 'https://via.placeholder.com/120',
          licensePhotos: Array.from(licensePhotos).map((_, i) => `https://via.placeholder.com/150x100?text=License+${i+1}`),
          vehiclePhoto: document.getElementById('vehiclePhotoPreview').querySelector('img')?.src || 'https://via.placeholder.com/250x150?text=Vehicle+Photo'
        };
        drivers.push(newDriver);
        localStorage.setItem('drivers', JSON.stringify(drivers));
        alert('Driver added successfully!');
        this.reset();
        document.getElementById('driverPhotoPreview').innerHTML = 'Preview';
        document.getElementById('licensePhotoPreview').innerHTML = '';
        document.getElementById('vehiclePhotoPreview').innerHTML = 'Preview';
        showTab('driverList');
        loadDrivers();
      });

      // File preview for Add Driver Form
      document.getElementById('driverPhoto').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = function(event) {
            document.getElementById('driverPhotoPreview').innerHTML = `<img src="${event.target.result}" style="width: 100%; height: 100%; object-fit: cover;" alt="Driver photo preview">`;
          };
          reader.readAsDataURL(file);
        }
      });

      document.getElementById('licensePhoto').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
          document.getElementById('licensePhotoPreview').innerHTML = '';
          Array.from(e.target.files).forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(event) {
              const img = document.createElement('img');
              img.src = event.target.result;
              img.style.width = '80px';
              img.style.height = '50px';
              img.style.objectFit = 'cover';
              img.alt = `License photo ${index + 1} preview`;
              document.getElementById('licensePhotoPreview').appendChild(img);
            };
            reader.readAsDataURL(file);
          });
        }
      });

      document.getElementById('vehiclePhoto').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = function(event) {
            document.getElementById('vehiclePhotoPreview').innerHTML = `<img src="${event.target.result}" style="width: 100%; height: 100%; object-fit: cover;" alt="Vehicle photo preview">`;
          };
          reader.readAsDataURL(file);
        }
      });

      // Search functionality
      document.getElementById('searchDriver').addEventListener('input', debounce(function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('#driverTableBody tr');
        rows.forEach(row => {
          const name = row.cells[0].textContent.toLowerCase();
          const license = row.cells[1].textContent.toLowerCase();
          const phone = row.cells[2].textContent.toLowerCase();
          const vehicle = row.cells[3].textContent.toLowerCase();
          row.style.display = (name.includes(searchTerm) || license.includes(searchTerm) || 
                              phone.includes(searchTerm) || vehicle.includes(searchTerm)) ? '' : 'none';
        });
      }, 300));

      // Filter functionality
      document.getElementById('filterStatus').addEventListener('change', filterDrivers);
      document.getElementById('filterVehicle').addEventListener('change', filterDrivers);

      function filterDrivers() {
        const statusFilter = document.getElementById('filterStatus').value;
        const vehicleFilter = document.getElementById('filterVehicle').value;
        const rows = document.querySelectorAll('#driverTableBody tr');
        rows.forEach(row => {
          const status = row.querySelector('.status').textContent.toLowerCase();
          const vehicle = row.cells[3].textContent.split(' - ')[0].toLowerCase();
          const statusMatch = !statusFilter || status === statusFilter;
          const vehicleMatch = !vehicleFilter || vehicle === vehicleFilter;
          row.style.display = (statusMatch && vehicleMatch) ? '' : 'none';
        });
      }

      // View driver details
      document.getElementById('driverTableBody').addEventListener('click', function(e) {
        if (e.target.classList.contains('view-btn')) {
          const row = e.target.closest('tr');
          if (!row) {
            alert('Error: Driver data not found.');
            return;
          }
          const driver = drivers.find(d => d.license === row.cells[1].textContent);
          document.getElementById('viewDriverName').textContent = driver.name;
          document.getElementById('viewLicense').textContent = driver.license;
          document.getElementById('viewPhone').textContent = driver.phone;
          document.getElementById('viewVehicle').textContent = driver.vehicle;
          document.getElementById('viewEmail').textContent = driver.email;
          const statusElement = document.getElementById('viewStatus');
          statusElement.textContent = driver.status.charAt(0).toUpperCase() + driver.status.slice(1);
          statusElement.className = 'status ' + driver.status;
          document.getElementById('viewLicenseExpiry').textContent = driver.licenseExpiry;
          document.getElementById('viewInsuranceExpiry').textContent = driver.insuranceExpiry;
          document.getElementById('viewDriverPhoto').src = driver.driverPhoto;
          document.getElementById('viewLicensePhotos').innerHTML = driver.licensePhotos.map((photo, i) => `<img src="${photo}" style="width: 120px; height: 80px; object-fit: cover; border: 1px solid #ddd;" alt="License photo ${i+1}">`).join('');
          document.getElementById('viewVehiclePhoto').innerHTML = `<img src="${driver.vehiclePhoto}" style="width: 100%; height: 80px; object-fit: cover; border: 1px solid #ddd;" alt="Vehicle photo">`;
          const viewModal = document.getElementById('viewDriverModal');
          viewModal.style.display = 'flex';
          viewModal.setAttribute('aria-hidden', 'false');
          viewModal.querySelector('h3').focus();
        }
      });

      // Edit driver details
      document.getElementById('driverTableBody').addEventListener('click', function(e) {
        if (e.target.classList.contains('edit-btn')) {
          const editFormContainer = document.getElementById('editFormContainer');
          if (editFormContainer.style.display === 'flex') return;
          const row = e.target.closest('tr');
          if (!row) {
            alert('Error: Driver data not found.');
            return;
          }
          const driver = drivers.find(d => d.license === row.cells[1].textContent);
          document.getElementById('editDriverId').value = driver.id;
          document.getElementById('editDriverName').value = driver.name;
          document.getElementById('editDriverLicense').value = driver.license;
          document.getElementById('editPhoneNumber').value = driver.phone;
          document.getElementById('editEmail').value = driver.email;
          document.getElementById('editVehicleType').value = driver.vehicle.split(' - ')[0];
          document.getElementById('editVehicleNumber').value = driver.vehicle.split(' - ')[1];
          document.getElementById('editLicenseExpiry').value = driver.licenseExpiry;
          document.getElementById('editInsuranceExpiry').value = driver.insuranceExpiry;
          document.getElementById('editDriverStatus').value = driver.status;
          document.getElementById('editDriverPhotoPreview').innerHTML = `<img src="${driver.driverPhoto}" style="width: 100%; height: 100%; object-fit: cover;" alt="Driver photo preview">`;
          document.getElementById('editLicensePhotoPreview').innerHTML = driver.licensePhotos.map((photo, i) => `<img src="${photo}" style="width: 80px; height: 50px; object-fit: cover;" alt="License photo ${i+1} preview">`).join('');
          document.getElementById('editVehiclePhotoPreview').innerHTML = `<img src="${driver.vehiclePhoto}" style="width: 100%; height: 100%; object-fit: cover;" alt="Vehicle photo preview">`;
          editFormContainer.style.display = 'flex';
          editFormContainer.setAttribute('aria-hidden', 'false');
          editFormContainer.querySelector('h3').focus();
        }
      });

      // File preview for Edit Driver Form
      document.getElementById('editDriverPhoto').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = function(event) {
            document.getElementById('editDriverPhotoPreview').innerHTML = `<img src="${event.target.result}" style="width: 100%; height: 100%; object-fit: cover;" alt="Driver photo preview">`;
          };
          reader.readAsDataURL(file);
        }
      });

      document.getElementById('editLicensePhoto').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
          document.getElementById('editLicensePhotoPreview').innerHTML = '';
          Array.from(e.target.files).forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(event) {
              const img = document.createElement('img');
              img.src = event.target.result;
              img.style.width = '80px';
              img.style.height = '50px';
              img.style.objectFit = 'cover';
              img.alt = `License photo ${index + 1} preview`;
              document.getElementById('editLicensePhotoPreview').appendChild(img);
            };
            reader.readAsDataURL(file);
          });
        }
      });

      document.getElementById('editVehiclePhoto').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = function(event) {
            document.getElementById('editVehiclePhotoPreview').innerHTML = `<img src="${event.target.result}" style="width: 100%; height: 100%; object-fit: cover;" alt="Vehicle photo preview">`;
          };
          reader.readAsDataURL(file);
        }
      });

      // Edit form submission
      document.getElementById('driverEditForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const licensePhotos = document.getElementById('editLicensePhoto').files;
        const email = document.getElementById('editEmail').value;
        const phone = document.getElementById('editPhoneNumber').value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const phoneRegex = /^\d{10}$/;

        if (licensePhotos.length > 0 && licensePhotos.length !== 2) {
          alert('Please upload exactly 2 license photos (front and back) or leave unchanged.');
          return;
        }
        if (!emailRegex.test(email)) {
          alert('Please enter a valid email address.');
          return;
        }
        if (!phoneRegex.test(phone)) {
          alert('Please enter a valid 10-digit phone number.');
          return;
        }

        const driverId = document.getElementById('editDriverId').value;
        const driverIndex = drivers.findIndex(d => d.id === driverId);
        if (driverIndex !== -1) {
          drivers[driverIndex] = {
            ...drivers[driverIndex],
            name: document.getElementById('editDriverName').value,
            license: document.getElementById('editDriverLicense').value,
            phone: document.getElementById('editPhoneNumber').value,
            email: document.getElementById('editEmail').value,
            vehicle: `${document.getElementById('editVehicleType').value} - ${document.getElementById('editVehicleNumber').value}`,
            status: document.getElementById('editDriverStatus').value,
            licenseExpiry: document.getElementById('editLicenseExpiry').value,
            insuranceExpiry: document.getElementById('editInsuranceExpiry').value,
            driverPhoto: document.getElementById('editDriverPhotoPreview').querySelector('img')?.src || drivers[driverIndex].driverPhoto,
            licensePhotos: licensePhotos.length === 2 ? Array.from(licensePhotos).map((_, i) => `https://via.placeholder.com/150x100?text=License+${i+1}`) : drivers[driverIndex].licensePhotos,
            vehiclePhoto: document.getElementById('editVehiclePhotoPreview').querySelector('img')?.src || drivers[driverIndex].vehiclePhoto
          };
          localStorage.setItem('drivers', JSON.stringify(drivers));
          loadDrivers(currentPage);
          alert('Driver details updated successfully!');
        }
        const editFormContainer = document.getElementById('editFormContainer');
        editFormContainer.style.display = 'none';
        editFormContainer.setAttribute('aria-hidden', 'true');
      });

      // Delete driver
      document.getElementById('driverTableBody').addEventListener('click', function(e) {
        if (e.target.classList.contains('delete-btn')) {
          if (confirm('Are you sure you want to delete this driver?')) {
            const row = e.target.closest('tr');
            const license = row.cells[1].textContent;
            drivers = drivers.filter(d => d.license !== license);
            localStorage.setItem('drivers', JSON.stringify(drivers));
            loadDrivers(currentPage);
            alert('Driver deleted successfully!');
          }
        }
      });

      // Close modals
      const viewModal = document.getElementById('viewDriverModal');
      const editFormContainer = document.getElementById('editFormContainer');
      document.getElementById('closeViewModal').onclick = () => {
        viewModal.style.display = 'none';
        viewModal.setAttribute('aria-hidden', 'true');
      };
      document.getElementById('closeEditForm').onclick = () => {
        editFormContainer.style.display = 'none';
        editFormContainer.setAttribute('aria-hidden', 'true');
      };
      document.getElementById('cancelEdit').onclick = () => {
        editFormContainer.style.display = 'none';
        editFormContainer.setAttribute('aria-hidden', 'true');
      };
      window.onclick = (e) => {
        if (e.target === viewModal) {
          viewModal.style.display = 'none';
          viewModal.setAttribute('aria-hidden', 'true');
        }
        if (e.target === editFormContainer) {
          editFormContainer.style.display = 'none';
          editFormContainer.setAttribute('aria-hidden', 'true');
        }
      };

      // Driver history filter
      document.getElementById('driverSelect').addEventListener('change', function() {
        const selectedDriver = this.value;
        const rows = document.querySelectorAll('#historyTableBody tr');
        rows.forEach(row => {
          const driverName = row.cells[0].textContent;
          if (selectedDriver === '' || driverName === document.querySelector(`#driverSelect option[value="${selectedDriver}"]`).textContent) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      });

      // Close sidebar on outside click
      document.addEventListener('click', function(e) {
        const sidebar = document.querySelector('.sidebar');
        const menuToggle = document.querySelector('.menu-toggle');
        if (window.innerWidth <= 992 && !sidebar.contains(e.target) && e.target !== menuToggle && !menuToggle.contains(e.target)) {
          sidebar.classList.remove('active');
          sidebar.setAttribute('aria-hidden', 'true');
        }
      });
    });
  </script>
</body>
</html>